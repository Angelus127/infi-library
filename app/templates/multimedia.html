{% extends 'base.html' %}
{% block title %}{{ tipo|capitalize }}{% endblock %}
{% block content %}
<h2>{{ tipo|capitalize }}</h2>

<div class="multimedia-header">
  <form class="buscar-form" method="get" action="{{ url_for('multimedia_routes.ver_multimedia', tipo=tipo) }}">
    <input type="text" name="q" placeholder="Buscar por título..." value="{{ busqueda }}">
    <select name="estado">
      <option value="" {% if not estado %}selected{% endif %}>Todos</option>
      <option value="Ongoing" {% if estado == 'ongoing' %}selected{% endif %}>En curso</option>
      <option value="Planned" {% if estado == 'planned' %}selected{% endif %}>Pendiente</option>
      <option value="Finished" {% if estado == 'finished' %}selected{% endif %}>Finalizado</option>
    </select>
    

    <select name="orden">
      <option value="id" {% if orden == 'id' %}selected{% endif %}>Recientes</option>
      <option value="titulo" {% if orden == 'titulo' %}selected{% endif %}>Título (A-Z)</option>
      <option value="titulo_desc" {% if orden == 'titulo_desc' %}selected{% endif %}>Título (Z-A)</option>
      <option value="puntuacion" {% if orden == 'puntuacion' %}selected{% endif %}>Puntuación</option>
    </select>

    <button type="submit">Filtrar</button>
  </form>

  <div class="conteo">
    <span>Total: {{ conteos.get('total', 0) }}</span>
    <span>Finalizados: {{ conteos.get('Finished', 0) }}</span>
    <span>En progreso: {{ conteos.get('Ongoing', 0) }}</span>
    <span>Planeados: {{ conteos.get('Planned', 0) }}</span>
  </div>

  <div class="agregar-wrapper">
    <a href="{{ url_for('admin_routes.agregar', tipo=tipo) }}" class="btn-agregar">
      ➕ Agregar {{ tipo|capitalize }}
    </a>
  </div>
</div>

  <div class="galeria">
    {% for item in data %}
    <div class="card">
      <a href="{{ url_for('multimedia_routes.ver_detalle', tipo=tipo, item_id=item.id) }}">
        <h3>{{ item.title }}</h3>
        <span class="score" data-score="{{ item.score }}">{{ item.score }}</span>
      </a>
    </div>
    {% else %}
      <p>No se encontraron resultados.</p>
    {% endfor %}
  </div>

  {% if total_paginas > 1 %}
  <div class="paginacion">
    {% if pagina > 1 %}
      <a href="{{ url_for('multimedia_routes.ver_multimedia', tipo=tipo, page=pagina-1, q=busqueda, estado=estado, orden=orden) }}">⬅ Anterior</a>
    {% endif %}

    <span>Página {{ pagina }} de {{ total_paginas }}</span>

    {% if pagina < total_paginas %}
      <a href="{{ url_for('multimedia_routes.ver_multimedia', tipo=tipo, page=pagina+1, q=busqueda, estado=estado, orden=orden) }}">Siguiente ➡</a>
    {% endif %}
  </div>
  {% endif %}
{% endblock %}
